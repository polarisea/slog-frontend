import{m as N,p as S,l as z,q as L,r as k,s as T,c as B,d as r,e as a,g as e,t as v,F as b,k as A,_ as D,a as R,u as j,x as U,b as X,o as q,i as t,f,y as E,z as V,w as O,v as G,h as w,A as J,B as K,C as P}from"./index-fb26eaf3.js";import{u as Q,r as W,m as Y}from"./index-68c85b3b.js";const M=N("comment",{state:()=>({comments:[],page:1,sortBy:0,isTyping:!1}),actions:{firstFetch(n){this.page=1,this.comments=[],this.fetchComments(n)},fetchComments(n){S.get(`api/comments?post=${n}&page=${this.page}${this.sortBy==0?"&order[id]=asc":"&order[id]=desc"}`).then(i=>{this.comments.splice(this.comments.length,0,...i.data),this.page+=1})},postComment(n,i,l,s){this.isTyping=!0;const c={content:i,user:`/api/users/${n}`,post:l,parent:s};S.post("/api/comments",c).then(d=>{if(this.isTyping=!1,s){for(let h=0;h<this.comments.length;h++)if(this.comments[h].id==s.split("/").at(-1)){this.comments[h].comments.push(d.data),console.log("add reply: ",this.comments[h],d.data);return}}this.sortBy==0?this.comments.unshift(d.data):this.comments.length<5&&this.comments.push(d.data)}).catch(d=>{this.isTyping=!1})},deleteComment(n,i){S.delete(`/api/comments/${n}`).then(l=>{if(console.log(l.data),i){e:for(let s=0;s<=this.comments.length;s++)if(this.comments[s].id==i){for(let c=0;c<=this.comments[s].comments.length;c++)if(this.comments[s].comments[c].id==n){this.comments[s].comments.splice(c,1);break e}}}else for(let s=0;s<=this.comments.length;s++)if(this.comments[s].id==n){this.comments.splice(s,1);break}}).catch(l=>{console.log(l),z.error("Xóa comment thất bại.")})}}}),Z={class:"mb-[0.5rem] flex w-full items-center justify-between py-[0.5rem] text-normal-text-color"},ee={class:"relative flex items-center"},te=e("span",{class:"mr-[0.5rem] text-[1rem]"},"Sắp xếp theo:",-1),se={class:"sortbox-openbtn flex items-center rounded-[1rem] px-[0.5rem] py-[0.25rem] text-[1rem] hover:bg-normal-btn-hover focus:bg-normal-btn-hover active:bg-normal-btn-active"},oe={class:""},ne=e("i",{class:"pi pi-chevron-down ml-[0.25rem] text-[0.75rem]"},null,-1),le=["disabled"],re=e("span",{class:"mx-[0.5rem] block h-[1px] flex-1 bg-line-color"},null,-1),ae={class:"relative text-[0.9rem] font-semibold text-title-text-color"},ie={__name:"commentFilter",props:["comments"],setup(n){const i=M(),l=L(),s=k([{label:"New",value:0},{label:"Old",value:1}]),{sortBy:c}=T(i),d=B(()=>s.value[c.value].label);async function h(o){for(let p=0;p<s.value.length;p++)if(o.target.textContent==s.value[p].label){c.value=p,i.firstFetch(l.params.id);break}}return(o,p)=>(r(),a("div",Z,[e("div",ee,[te,e("button",se,[e("span",oe,v(d.value),1),ne]),e("div",{class:"sortbox absolute right-0 top-[2.5rem] z-30 w-[10rem] bg-gray-50 py-[0.5rem] shadow-md",onClick:h},[(r(!0),a(b,null,A(s.value,x=>(r(),a("button",{class:"block w-full px-[1rem] py-[0.5rem] text-left text-[1rem] hover:bg-normal-btn-hover active:bg-normal-btn-active disabled:bg-normal-btn-hover disabled:text-green-btn-text-color",disabled:x.label==d.value},v(x.label),9,le))),256))])]),re,e("span",ae,v(n.comments.length)+" comments ",1)]))}};const _=n=>(K("data-v-9741c1f3"),n=n(),P(),n),ce={class:"relative flex w-full text-normal-text-color max-lg:flex-col"},me={key:0,class:"m-auto w-fit h-fit"},ue=_(()=>e("i",{class:"pi pi-spin pi-spinner text-[3rem] font-semibold"},null,-1)),de=[ue],he={class:"flex items-start text-normal-text-color"},pe=["src"],_e={class:"ml-[0.5rem] block leading-none"},fe={class:"my-[0.5rem] block text-[1.5rem] font-semibold text-title-text-color"},ve=["innerHTML"],be={key:0,class:"h-boxshadow relative mt-[-4rem] h-[4rem] w-full px-[1rem]"},xe={class:"mt-[0.5rem] flex items-center"},ge={class:"flex w-fit items-center rounded-[1rem] bg-green-100 px-[1rem] py-[0.25rem] text-[1rem] text-normal-text-color"},ye=_(()=>e("i",{class:"pi pi-arrow-up"},null,-1)),we=[ye],ke={class:"z-20 mx-[0.25rem]"},$e=_(()=>e("i",{class:"pi pi-arrow-down"},null,-1)),Ce=[$e],Se={class:"relative block"},Ve=_(()=>e("span",{class:"my-[0.5rem] block h-[1px] w-full bg-line-color"},null,-1)),Te={class:"block w-full"},Be=_(()=>e("span",{class:"my-[0.5rem] block h-[1px] w-full bg-line-color"},null,-1)),Ae={class:"sticky top-[4rem] h-[calc(100vh-4rem)] w-[20rem] px-[1rem] pr-[2rem] pt-[2rem] max-lg:w-full"},ze=_(()=>e("span",{class:"mb-[1rem] block text-[1.2rem] font-semibold"}," Có thể bạn sẽ thích",-1)),Le={key:0,class:"m-auto w-fit h-fit"},Me=_(()=>e("i",{class:"pi pi-spin pi-spinner text-[2rem]"},null,-1)),Fe=[Me],He=_(()=>e("span",{class:"bg-line-color-200 mx-auto my-[1rem] block h-[1px] w-[100%] max-lg:w-full"},null,-1)),Ie={__name:"ArticleView",setup(n){const i=L(),l=R(),s=j(),c=M(),d=U(),h=X(),{article:o}=T(l),{comments:p,isTyping:x}=T(c),$=k(!1),C=k(!1),g=k("");q(()=>{window.scrollTo(0,0)});const F=B(()=>({commentValue:{required:W,minLength:Y(1)}})),y=Q(F,{commentValue:g});s.status!="user-view"&&(s.initUserView(),h.fetchTags()),l.fetchArticle(i.params.id),l.fetchRecommends(),c.firstFetch(i.params.id);const H=B(()=>o.value.createdAt?J(new Date(o.value.createdAt),{addSuffix:!0}):0);async function I(){await y.value.$validate(),y.value.commentValue.$error||(d.info?(c.postComment(d.info.id,g.value,`/api/posts/${i.params.id}`),g.value="",y.value.$reset()):z.error("Bạn chưa đăng nhập",{autoClose:2e3}))}return(Ne,m)=>(r(),a("div",ce,[e("div",{class:w(["flex-1 px-[1rem] py-[1rem] max-lg:pr-[2rem]",{"flex flex-col":!t(o)}])},[t(o)?f("",!0):(r(),a("div",me,de)),t(o)?(r(),a(b,{key:1},[e("div",he,[e("img",{class:"h-[2rem] w-[2rem] rounded-[2rem] bg-gray-300",src:t(o).user?t(o).user.photo:"",alt:""},null,8,pe),e("span",_e,v(t(o).user?t(o).user.name:"")+"   •   "+v(H.value),1)]),e("span",fe,v(t(o).title),1),e("div",{innerHTML:t(o).content,class:"overflow-y-hidden text-justify"},null,8,ve),t(o).toHide&&$.value==!1?(r(),a("div",be)):f("",!0),t(o).toHide&&$.value==!1?(r(),a("a",{key:1,onClick:m[0]||(m[0]=E(u=>$.value=!0,["prevent"])),class:"mb-[0.5rem] block cursor-pointer text-blue-500"},"Xem toàn bộ")):f("",!0),e("div",xe,[e("span",ge,[e("button",{class:"z-20 leading-none hover:bg-normal-btn-hover active:bg-normal-btn-active",onClick:m[1]||(m[1]=u=>t(l).postVote(1,t(o).id))},we),e("span",ke,v(t(o).score),1),e("button",{class:"z-20 leading-none hover:bg-normal-btn-hover active:bg-normal-btn-active",onClick:m[2]||(m[2]=u=>t(l).postVote(-1,t(o).id))},Ce)])]),V(ie,{comments:t(o).comments},null,8,["comments"]),e("span",Se,[O(e("textarea",{class:w(["w-full resize-none rounded-[1rem] border-[2px] border-border-color px-[1rem] py-[0.25rem] text-[1rem] text-normal-text-color outline-normal-btn-active",{"outline-red-500 border-red-500":t(y).commentValue.$error}]),placeholder:"Comment...",rows:"2","onUpdate:modelValue":m[3]||(m[3]=u=>g.value=u)},null,2),[[G,g.value]]),e("button",{class:"absolute right-[1rem] top-[50%] translate-y-[-50%] text-green-btn-text-color",onClick:I},[e("i",{class:w(["pi text-[1.5rem]",{"pi-spin pi-spinner":t(x)," pi-send":!t(x)}])},null,2)])]),Ve,e("div",Te,[(r(!0),a(b,null,A(t(p),u=>(r(),a(b,null,[V(u,{comment:u},null,8,["comment"]),Be],64))),256)),t(p).length<t(o).comments.length?(r(),a("button",{key:0,class:"text-[1rem] text-error-color",onClick:m[4]||(m[4]=u=>t(c).fetchComments(t(i).params.id))}," Xem thêm ")):f("",!0)])],64)):f("",!0)],2),e("div",Ae,[ze,t(l).recommends?f("",!0):(r(),a("div",Le,Fe)),t(l).recommends?(r(),a("div",{key:1,class:w([{"overflow-y-hidden":!C.value},"normal-scrollbar sticky top-[6rem] w-full overflow-y-auto lg:h-[calc(100vh-8rem)]"]),onMouseenter:m[5]||(m[5]=u=>C.value=!0),onMouseleave:m[6]||(m[6]=u=>C.value=!1)},[e("ul",null,[(r(!0),a(b,null,A(t(l).recommends,u=>(r(),a(b,null,[e("li",null,[V(u,{recommend:u},null,8,["recommend"])]),He],64))),256))])],34)):f("",!0)])]))}},je=D(Ie,[["__scopeId","data-v-9741c1f3"]]);export{je as default};
